<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K·ª∑ ni·ªám 2 th√°ng</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* --- C·∫§U H√åNH GIAO DI·ªÜN --- */
        :root {
            --primary: #ff8fa3;
            --bg-dark: #121212;
            --text-light: #f0f0f0;
        }
        body {
            margin: 0; padding: 0;
            height: 100vh; height: -webkit-fill-available;
            display: flex; justify-content: center; align-items: center;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 30%, #2a1a20 0%, #000000 100%);
            font-family: 'Segoe UI', Roboto, sans-serif;
            overflow: hidden; color: var(--text-light);
            touch-action: none; /* Ch·ªëng cu·ªôn trang khi ch∆°i game */
        }

        #main-container {
            width: 90vw; height: 85vh;
            max-width: 420px;
            position: relative;
            background: rgba(255,255,255,0.05);
            border-radius: 24px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        /* --- QU·∫¢N L√ù C√ÅC M√ÄN (STAGES) --- */
        .stage {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex; flex-direction: column;
            padding: 20px; box-sizing: border-box;
            opacity: 0; pointer-events: none;
            transition: opacity 0.5s ease, transform 0.5s ease;
            transform: scale(0.95);
            z-index: 1;
        }
        .stage.active { opacity: 1; pointer-events: auto; transform: scale(1); z-index: 10; }
        .stage.completed { opacity: 0; pointer-events: none; transform: translateY(-30px); }

        .game-header { text-align: center; margin-bottom: 10px; flex-shrink: 0; }
        .game-title { color: var(--primary); font-size: 1.1rem; margin: 0; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .game-instruction { font-size: 0.8rem; opacity: 0.7; margin-top: 3px; font-style: italic; }

        /* KHUNG GAME */
        .game-area {
            flex: 1; position: relative;
            border-radius: 12px; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.15);
            display: flex; justify-content: center; align-items: center;
            background: #000;
        }
        .hidden-photo {
            width: 100%; height: 100%; object-fit: cover;
            position: absolute; top: 0; left: 0; z-index: 1;
        }

        /* KHUNG CH·ªÆ (CAPTION) */
        .caption-container {
            min-height: 80px; margin-top: 15px;
            display: flex; flex-direction: column; align-items: center;
            opacity: 0; transition: opacity 0.8s;
        }
        .stage.reveal .caption-container { opacity: 1; }

        .caption-text {
            background: rgba(255,255,255,0.1); padding: 10px 15px;
            border-radius: 12px; font-size: 0.9rem; line-height: 1.4;
            text-align: center; color: #eee; width: 100%; box-sizing: border-box;
        }

        /* N√öT TI·∫æP T·ª§C (Ch·ªâ hi·ªán khi th·∫Øng) */
        .next-btn {
            margin-top: 10px;
            background: linear-gradient(45deg, #ff8fa3, #ffc1e3);
            border: none; padding: 8px 25px; border-radius: 20px;
            color: #fff; font-weight: bold; font-size: 0.9rem;
            cursor: pointer; opacity: 0; pointer-events: none;
            transform: translateY(10px); transition: all 0.5s;
            box-shadow: 0 4px 15px rgba(255, 143, 163, 0.4);
        }
        .stage.reveal .next-btn {
            opacity: 1; pointer-events: auto; transform: translateY(0);
        }
        .next-btn:active { transform: scale(0.95); }

        /* --- GAME 1: B√ìC QU√Ä (5x5) --- */
        .gift-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5;
            display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr);
        }
        .gift-piece {
            background: #ffb7b2; border: 1px solid rgba(255,255,255,0.2);
            transition: 0.3s;
        }
        .gift-piece.ripped { opacity: 0; pointer-events: none; transform: scale(0.5); }

        /* --- GAME 2: PUZZLE (3x3) --- */
        .puzzle-grid {
            width: 100%; height: 100%; z-index: 5;
            display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr);
            gap: 1px; background: #333;
        }
        .puzzle-piece {
            background-image: url('https://i.imgur.com/gm4qaiD.jpeg'); /* ·∫¢nh m·ªõi */
            background-size: 300% 300%; /* V√¨ chia 3 c·ªôt */
            transition: transform 0.3s, filter 0.3s;
            filter: brightness(0.7) sepia(0.5);
            cursor: pointer;
        }
        .puzzle-piece.solved { filter: none; cursor: default; z-index: 1; }

        /* --- GAME 3: LAU K√çNH --- */
        .fog-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 6;
            background: rgba(200,220,255,0.5); backdrop-filter: blur(20px);
            transition: opacity 0.5s;
        }

        /* --- M√ÄN 4: HOA SEN --- */
        .final-msg {
            height: 50%; overflow-y: auto; font-size: 0.95rem; line-height: 1.6;
            padding: 0 5px; margin-bottom: 10px;
        }
        .lotus-wrapper { height: 160px; display: flex; justify-content: center; align-items: flex-end; }
        .lotus-svg { width: 140px; height: auto; opacity: 0; transform: translateY(30px); transition: 2s; }
        .lotus-svg.bloom { opacity: 1; transform: translateY(0); }

        /* --- M√ÄN 5: L√Å TH∆Ø B√ç M·∫¨T --- */
        .envelope-container {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; cursor: pointer; transition: 0.5s;
        }
        .envelope-icon { font-size: 80px; animation: bounce 2s infinite; }
        .click-hint { font-size: 0.9rem; margin-top: 10px; opacity: 0.8; }
        
        .letter-content {
            display: none; width: 100%; height: 100%;
            background: #fff; color: #333;
            border-radius: 10px; padding: 25px; box-sizing: border-box;
            font-family: 'Times New Roman', serif;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
            overflow-y: auto;
            animation: unfold 1s ease forwards;
        }
        .letter-text { font-size: 1.05rem; line-height: 1.8; text-align: justify; }
        .letter-sign { text-align: right; margin-top: 20px; font-weight: bold; font-style: italic; }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes unfold { from { transform: scaleY(0); opacity: 0; } to { transform: scaleY(1); opacity: 1; } }

    </style>
</head>
<body>

<div id="main-container">

    <div id="stage1" class="stage active">
        <div class="game-header">
            <h3 class="game-title">M√†n 1: Ph√° BƒÉng</h3>
            <div class="game-instruction">Ch·∫°m v√†o t·ª´ng √¥ ƒë·ªÉ m·ªü qu√† (25 √¥)</div>
        </div>
        <div class="game-area">
            <img src="https://i.imgur.com/9WzXQUg.jpeg" class="hidden-photo">
            <div class="gift-layer" id="giftGrid"></div>
        </div>
        <div class="caption-container">
            <div class="caption-text">Anh c√≥ nh·ªõ hƒÉm ƒë√¢y l√† ng√†y ƒë·∫ßu ti√™n m√† m√¨nh ƒëi ch∆°i v·ªõi nhau n√® :> th·∫•y v·∫≠y th√¥i c≈©ng t∆∞·ªüng r·ªß hƒÉm ƒë∆∞·ª£c ƒë√≥ t·∫°i ƒë√≥ gi·ªù r·ªß c√≥ bao gi·ªù ƒë∆∞·ª£c ƒë√¢u -.-</div>
            <button class="next-btn" onclick="goToStage(2)">Ti·∫øp t·ª•c &rarr;</button>
        </div>
    </div>

    <div id="stage2" class="stage">
        <div class="game-header">
            <h3 class="game-title">M√†n 2: Gh√©p K√Ω ·ª®c</h3>
            <div class="game-instruction">Xoay 9 m·∫£nh gh√©p v·ªÅ ƒë√∫ng chi·ªÅu</div>
        </div>
        <div class="game-area" style="background: transparent; border: none;">
            <div class="puzzle-grid" id="puzzleGrid">
                </div>
        </div>
        <div class="caption-container">
            <div class="caption-text">Anh c√≥ nh·ªõ ng√†y ƒë·∫ßu ti√™n m√¨nh quen nhau hongggg, n√≥i ƒë·ª´ng c√≥ c∆∞·ªùi ch·ª© ƒë√¢y l√† l·∫ßn ƒë·∫ßu ti√™n em ƒë∆∞·ª£c t·∫∑ng hoa =))</div>
            <button class="next-btn" onclick="goToStage(3)">Ti·∫øp t·ª•c &rarr;</button>
        </div>
    </div>

    <div id="stage3" class="stage">
        <div class="game-header">
            <h3 class="game-title">M√†n 3: T√¨m L·∫°i ·∫¢nh R√µ</h3>
            <div class="game-instruction">Ch·∫°m li√™n t·ª•c 30 l·∫ßn ƒë·ªÉ lau k√≠nh</div>
        </div>
        <div class="game-area" onclick="tapToClean()">
            <img src="https://i.imgur.com/FettR33.jpeg" class="hidden-photo" id="photoBlur" style="filter: blur(30px);">
            <div class="fog-layer" id="fogLayer"></div>
        </div>
        <div class="caption-container">
            <div class="caption-text">Em hong tin l√† t·ª´ b·∫°n qua m·∫°ng m√† m√¨nh c√≥ th·ªÉ quen nhau t·ªõi b√¢y gi·ªù ƒë√≥ :> k·ª∑ ni·ªám 1 th√°nggggg</div>
            <button class="next-btn" onclick="goToStage(4)">Ti·∫øp t·ª•c &rarr;</button>
        </div>
    </div>

    <div id="stage4" class="stage">
        <h2 style="text-align: center; color: #ff8fa3; margin: 10px 0;">Happy 2 Months! üéâ</h2>
        <div class="final-msg">H√¥m nay l√† k·ª∑ ni·ªám 2 th√°ng r·ªìi d√π c√≥ nhi·ªÅu bi·∫øn c·ªë, nhi·ªÅu chuy·ªán bu·ªìn c≈©ng nh∆∞ c√≥ nhi·ªÅu chuy·ªán vui, ai c≈©ng c√≥ quan ƒëi·ªÉm, c≈©ng c√≥ c√°ch s·ªëng, c≈©ng c√≥ t√¨nh c·∫£nh ri√™ng trong m·ªçi v·∫•n ƒë·ªÅ c·ªßa m·ªói ng∆∞·ªùi tuy nhi√™n d√π c√≥ nhi·ªÅu kh√°c bi·ªát ·∫•y m√¨nh v·∫´n ·ªü ƒë√¢y, theo em m·ªëi quan h·ªá t√¨nh c·∫£m kh√¥ng ph·∫£i l√† ho√† h·ª£p v·ªõi nhau m√† l√† c√πng ph√°t tri·ªÉn ƒëi·ªÉm chung v√† t√¥n tr·ªçng ƒëi·ªÉm kh√°c bi·ªát, h∆∞·ªõng ƒë·∫øn m·ª•c ti√™u chung v√¨ h·∫°nh ph√∫c chung, em mong r·∫±ng d√π cho mai v·ªÅ sau em mong r·∫±ng anh s·∫Ω th·∫≠t h·∫°nh ph√∫c, m·∫°nh kho·∫ª v√† lu√¥n m·ªân c∆∞·ªùi anh nh√©, em th∆∞∆°ng anh nhi·ªÅuuuuuuu v√† anh h√£y th∆∞∆°ng anh nhi·ªÅu nh√©, em luon dung ve phia anhhh</div>
        
        <div class="lotus-wrapper">
             <svg class="lotus-svg" id="lotusObj" viewBox="0 0 200 150">
                <defs>
                    <radialGradient id="pGrad" cx="50%" cy="100%" r="80%"><stop offset="0" stop-color="#fff"/><stop offset="1" stop-color="#ffc1e3"/></radialGradient>
                    <filter id="glow"><feGaussianBlur stdDeviation="3" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                </defs>
                <g filter="url(#glow)">
                    <path d="M60 110 Q30 80 50 50 Q70 80 80 110" fill="url(#pGrad)" stroke="#eec0c0" stroke-width="0.5" />
                    <path d="M140 110 Q170 80 150 50 Q130 80 120 110" fill="url(#pGrad)" stroke="#eec0c0" stroke-width="0.5" />
                    <path d="M40 120 Q10 90 30 70 Q60 100 70 125" fill="url(#pGrad)" stroke="#eec0c0" stroke-width="0.5" />
                    <path d="M160 120 Q190 90 170 70 Q140 100 130 125" fill="url(#pGrad)" stroke="#eec0c0" stroke-width="0.5" />
                    <path d="M80 115 Q60 60 90 30 Q110 60 100 115" fill="#fff" stroke="#eec0c0" stroke-width="0.5" />
                    <path d="M120 115 Q140 60 110 30 Q90 60 100 115" fill="#fff" stroke="#eec0c0" stroke-width="0.5" />
                    <path d="M100 120 Q75 70 100 20 Q125 70 100 120" fill="#ffffff" stroke="#ffb7b2" stroke-width="1" />
                    <circle cx="100" cy="90" r="5" fill="#ffd700" opacity="0.8" />
                </g>
                <path d="M40 130 Q100 160 160 130" fill="none" stroke="#81c784" stroke-width="3" stroke-linecap="round"/>
            </svg>
        </div>
        
        <div class="caption-container" style="opacity: 1; margin-top: 5px;">
            <button class="next-btn" style="opacity: 1; pointer-events: auto; transform: translateY(0);" onclick="goToStage(5)">V·∫´n c√≤n m·ªôt ƒëi·ªÅu n·ªØa... &rarr;</button>
        </div>
    </div>

    <div id="stage5" class="stage">
        <div class="envelope-container" id="envelopeBox" onclick="openLetter()">
            <div class="envelope-icon">üì©</div>
            <div class="click-hint">C√≥ m·ªôt l√° th∆∞ d√†nh cho anh<br>(Ch·∫°m ƒë·ªÉ m·ªü)</div>
        </div>

        <div class="letter-content" id="letterContent">
            <h3 style="text-align: center; color: #555; margin-top: 0;">G·ª≠i anh...</h3>
            <div class="letter-text">
                Th·∫≠t ra em v·∫´n c√≤n nhi·ªÅu chuy·ªán mu·ªën ƒë∆∞·ª£c n√≥i ra nh∆∞ng em nghƒ© khi n√≥i ra ch√∫ng ta s·∫Ω b·ªã ƒë·ªëi l·∫≠p quan ƒëi·ªÉm s√¢u s·∫Øc ho·∫∑c anh kh√¥ng ch·∫•p nh·∫≠n ƒë∆∞·ª£c n√™n ƒë·ª´ng gi·∫≠n em nha. Em n√≥i kh√¥ng ph·∫£i ƒë·ªÉ anh t√≤ m√≤ m√† th·ª±c s·ª± em v·∫´n c√≤n r·∫•t nhi·ªÅu v·∫•n ƒë·ªÅ v√† em xin gi·ªØ cho em ch·ªù khi n√†o em c·∫£m gi√°c an to√†n cho m·ªëi quan h·ªá ƒë·ªÉ n√≥i ra th√¨ m√¨nh c√πng tr√≤ chuy·ªán nha anh :< ƒë√¢y l√† th·ª© l√†m em phi·ªÅn l√≤ng r·∫•t nhi·ªÅu nh∆∞ng m√† em s·∫Ω ch·ªù, anh c≈©ng ƒë·ª´ng v·ªôi nha :<
            </div>
            <div class="letter-sign">Th∆∞∆°ng anh ‚ù§Ô∏è</div>
        </div>
    </div>

</div>

<script>
    // --- GAME 1: B√ìC QU√Ä 5x5 (25 √¥) ---
    const grid1 = document.getElementById('giftGrid');
    let pieces1 = 25;
    let opened1 = 0;
    
    for(let i=0; i<25; i++) {
        let div = document.createElement('div');
        div.className = 'gift-piece';
        div.onclick = function() {
            if(!this.classList.contains('ripped')) {
                this.classList.add('ripped');
                opened1++;
                if(navigator.vibrate) navigator.vibrate(10);
                if(opened1 === pieces1) showNext(1);
            }
        }
        grid1.appendChild(div);
    }

    // --- GAME 2: PUZZLE 3x3 (9 √¥) ---
    const grid2 = document.getElementById('puzzleGrid');
    const positions = ['0% 0%', '50% 0%', '100% 0%', '0% 50%', '50% 50%', '100% 50%', '0% 100%', '50% 100%', '100% 100%'];
    
    for(let i=0; i<9; i++) {
        let div = document.createElement('div');
        div.className = 'puzzle-piece';
        // Set background ƒë√∫ng v·ªã tr√≠
        div.style.backgroundPosition = positions[i];
        
        // Random xoay ban ƒë·∫ßu (tr√°nh 0 ƒë·ªô)
        let rots = [90, 180, 270];
        let startRot = rots[Math.floor(Math.random()*3)];
        div.setAttribute('data-rot', startRot);
        div.style.transform = `rotate(${startRot}deg)`;

        div.onclick = function() {
            if(this.classList.contains('solved')) return;
            
            let r = parseInt(this.getAttribute('data-rot'));
            r += 90;
            this.style.transform = `rotate(${r}deg)`;
            this.setAttribute('data-rot', r);
            
            checkPuzzle();
        }
        grid2.appendChild(div);
    }

    function checkPuzzle() {
        let pieces = document.querySelectorAll('.puzzle-piece');
        let done = true;
        pieces.forEach(p => {
            let r = parseInt(p.getAttribute('data-rot'));
            if(r % 360 !== 0) done = false;
        });
        
        if(done) {
            pieces.forEach(p => {
                p.classList.add('solved');
                p.style.filter = 'brightness(1.1)';
            });
            showNext(2);
        }
    }

    // --- GAME 3: LAU K√çNH (30 Taps) ---
    let taps = 0;
    const maxTaps = 30;
    function tapToClean() {
        if(taps >= maxTaps) return;
        taps++;
        
        let blur = 30 - (taps/maxTaps)*30;
        let opacity = 1 - (taps/maxTaps);
        
        document.getElementById('photoBlur').style.filter = `blur(${blur}px)`;
        document.getElementById('fogLayer').style.opacity = opacity;

        if(taps === maxTaps) {
            document.getElementById('photoBlur').style.filter = 'none';
            showNext(3);
        }
    }

    // --- CHUY·ªÇN M√ÄN CHUNG ---
    function showNext(stageId) {
        document.getElementById(`stage${stageId}`).classList.add('reveal');
        if(navigator.vibrate) navigator.vibrate([50,50,50]);
    }

    function goToStage(nextId) {
        // ·∫®n m√†n hi·ªán t·∫°i
        document.querySelector('.stage.active').classList.remove('active');
        document.querySelector('.stage.active')?.classList.add('completed');
        
        // Hi·ªán m√†n m·ªõi
        let nextStage = document.getElementById(`stage${nextId}`);
        nextStage.classList.add('active');

        // N·∫øu l√† m√†n 4 (Hoa sen) th√¨ k√≠ch ho·∫°t hi·ªáu ·ª©ng
        if(nextId === 4) {
            setTimeout(() => {
                document.getElementById('lotusObj').classList.add('bloom');
                fireConfetti();
            }, 500);
        }
    }

    function fireConfetti() {
        let end = Date.now() + 3000;
        let colors = ['#ffc1e3', '#ffffff', '#ffd700'];
        (function frame() {
            if (Date.now() > end) return;
            confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0 }, colors: colors });
            confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1 }, colors: colors });
            requestAnimationFrame(frame);
        }());
    }

    // --- L√Å TH∆Ø B√ç M·∫¨T ---
    function openLetter() {
        document.getElementById('envelopeBox').style.display = 'none';
        document.getElementById('letterContent').style.display = 'block';
    }
</script>
</body>
</html>
